# åŸºäº Electra + CNN çš„æ³•å¾‹ç½ªåé¢„æµ‹ç³»ç»Ÿ



## æ‘˜è¦

é’ˆå¯¹ä¸­æ–‡æ³•å¾‹æ–‡æœ¬ç½ªååˆ†ç±»çš„å¤æ‚æ€§ï¼Œæœ¬ç ”ç©¶æå‡ºäº†ä¸€ç§åŸºäºELECTRAé¢„è®­ç»ƒæ¨¡å‹ä¸å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰èåˆçš„æ³•å¾‹ç½ªåé¢„æµ‹ç³»ç»Ÿã€‚

æœ¬ç³»ç»Ÿé‡‡ç”¨å“ˆå°”æ»¨å·¥ä¸šå¤§å­¦å¼€æºçš„é¢„è®­ç»ƒæ¨¡å‹ä½œä¸ºè¯­ä¹‰ç¼–ç å™¨ï¼Œé€šè¿‡åŠ¨æ€æ»‘åŠ¨çª—å£æœºåˆ¶æå–å±€éƒ¨è¯­ä¹‰ç‰¹å¾ï¼Œæ„å»ºåŒ…å«å…¨å±€æœ€å¤§æ± åŒ–ä¸æ­£åˆ™åŒ–æŠ€æœ¯çš„å¤šçº§åˆ†ç±»æ¶æ„ã€‚

å®éªŒé‡‡ç”¨çœŸå®å¸æ³•æ–‡ä¹¦æ•°æ®é›†ï¼Œé€šè¿‡åŒé‡æ•°æ®æ¸…æ´—ç­–ç•¥ï¼ˆå¤šç½ªåæ ·æœ¬å‰”é™¤ã€ç‰¹æ®Šå­—ç¬¦è¿‡æ»¤ï¼‰å’ŒåŠ¨æ€ç½ªååŠ è½½æœºåˆ¶ï¼Œåœ¨50ä¸‡æ¡è®­ç»ƒæ ·æœ¬ä¸Šå®ç°å•è½®è®­ç»ƒæ•ˆç‡ä¼˜åŒ–ã€‚

æµ‹è¯•é›†è¯„ä¼°æ˜¾ç¤ºï¼Œç³»ç»Ÿåœ¨ç›—çªƒã€å±é™©é©¾é©¶ç­‰é«˜é¢‘ç½ªåä¸­è¾¾åˆ°98.45%çš„F1å€¼ï¼Œå®è§‚å‡†ç¡®ç‡è¾¾88.47%ï¼Œä½†åœ¨æ ·æœ¬é‡ä½äº10çš„68ä¸ªä½é¢‘ç½ªåä¸­å‡ºç°ä¸¥é‡è¯†åˆ«å¤±æ•ˆã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ¨¡å‹é€šè¿‡çŠ¯ç½ªäº‹å®æ–‡æœ¬ç‰¹å¾å­¦ä¹ ï¼Œåœ¨æ¯’å“çŠ¯ç½ªï¼ˆF1=97.23%ï¼‰å’Œç›—çªƒæ¡ˆä»¶ï¼ˆRecall=98.27%ï¼‰ä¸­å±•ç°å‡ºç±»æ³•å¾‹ä¸“å®¶æ°´å¹³çš„åˆ¤åˆ«èƒ½åŠ›ï¼Œä½†å¯¹å¤æ‚ç»æµçŠ¯ç½ªï¼ˆå¦‚åˆåŒè¯ˆéª—Precision=66.76%ï¼‰å’Œæ–°å‹ç½‘ç»œçŠ¯ç½ªï¼ˆå¦‚å¸®åŠ©ä¿¡æ¯ç½‘ç»œçŠ¯ç½ªæ´»åŠ¨ç½ªF1=0ï¼‰çš„æ³›åŒ–èƒ½åŠ›æœ‰é™ã€‚

æœ¬ç ”ç©¶è¯å®äº†é¢„è®­ç»ƒæ¨¡å‹åœ¨æ³•å¾‹æ–‡æœ¬è¡¨å¾ä¸­çš„æœ‰æ•ˆæ€§ï¼ŒåŒæ—¶æ­ç¤ºäº†å¸æ³•äººå·¥æ™ºèƒ½é¢ä¸´çš„é•¿å°¾åˆ†å¸ƒå›°å¢ƒï¼Œä¸ºåç»­ç ”ç©¶æä¾›äº†æ•°æ®å¢å¼ºä¸è¿ç§»å­¦ä¹ ç»“åˆçš„æ”¹è¿›æ–¹å‘ã€‚



## è¿è¡Œç¯å¢ƒ

### GPUç¯å¢ƒ

æœ¬é¡¹ç›®ä½¿ç”¨`conda`åˆ›å»ºpythonè™šæ‹Ÿç¯å¢ƒï¼Œä½¿ç”¨GPUè¿›è¡Œè®­ç»ƒï¼ŒCUDAå’ŒcuDNNç‰ˆæœ¬[å‚è€ƒæ­¤ç½‘å€](https://tensorflow.google.cn/install/source_windows?hl=en#gpu)

| Version               | Python version | cuDNN | CUDA |
| :-------------------- | :------------- | :---- | :--- |
| tensorflow_gpu-2.10.0 | 3.8            | 8.1   | 11.2 |

```
NVIDIA GeForce RTX 4060 Laptop GPU

é©±åŠ¨ç¨‹åºç‰ˆæœ¬:	32.0.15.7270
é©±åŠ¨ç¨‹åºæ—¥æœŸ:	2025/3/3
DirectX ç‰ˆæœ¬:	12 (FL 12.1)
ç‰©ç†ä½ç½®ï¼š	PCI æ€»çº¿ 1ã€è®¾å¤‡ 0ã€åŠŸèƒ½ 0

ä¸“ç”¨ GPU å†…å­˜	8.0 GB
å…±äº« GPU å†…å­˜	7.6 GB
GPU å†…å­˜	15.6 GB
```



### è½¯ä»¶åŒ…ä¾èµ–

`requirements.txt`

```
tensorflow-gpu==2.10.0
numpy==1.23.5
transformers==4.30.0
scikit-learn==1.0.2
tqdm==4.65.0
jieba==0.42.1
Keras==2.10.0
```



## é¡¹ç›®å®ç°åŸç†

### æµç¨‹å›¾

```
ã€è¾“å…¥çŠ¯ç½ªäº‹å®ã€‘
      â†“
é¢„è®­ç»ƒæ¨¡å‹ç¼–ç ï¼šæŠŠè¯å˜æˆå‘é‡
      â†“
CNNï¼šæ»‘åŠ¨çª—å£æå–è¯ç»„ç‰¹å¾
      â†“
GlobalMaxPoolingï¼šæŒ‘å‡ºæœ€æ˜æ˜¾çš„ç‰¹å¾
      â†“
Denseï¼šæ˜ å°„æˆä¸åŒç½ªåçš„åˆ†æ•°
      â†“
Softmaxï¼šè½¬æˆæ¦‚ç‡ï¼Œé€‰å‡ºé¢„æµ‹ç»“æœ
      â†“
ã€è¾“å‡ºç½ªå ã€‘
```



### ä¸€ã€æ•°æ®æ¸…æ´—

1. æ¸…æ´—å¤šé‡ç½ªåæ•°æ®

   ç”±äºéƒ¨åˆ†æ•°æ®é›†ä¸­çš„accusationå­—æ®µå«æœ‰å¤šä¸ªç½ªåï¼Œéœ€è¦åˆ é™¤åœ¨jsonä¸­å¯¹åº”çš„è¡Œï¼Œå‡å°æ‚æ•°æ®å¯¹æ¨¡å‹çš„å¹²æ‰°ã€‚ä»£ç å®ç°å¦‚ä¸‹

   ```python
   import os
   import json
   
   def clean_json_files(folder_path):
       for root, dirs, files in os.walk(folder_path):
           for file in files:
               if file.endswith('.json'):
                   file_path = os.path.join(root, file)
                   try:
                       with open(file_path, 'r', encoding='utf-8') as f:
                           lines = f.readlines()  # è¯»å–æ‰€æœ‰è¡Œï¼ˆæ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡ï¼‰
   
                       valid_lines = []
                       for line in lines:
                           line = line.strip()  # å»é™¤è¡Œé¦–å°¾ç©ºæ ¼å’Œæ¢è¡Œç¬¦
                           if not line:
                               continue  # è·³è¿‡ç©ºè¡Œ
                           
                           try:
                               data = json.loads(line)  # è§£æ JSON æ•°æ®
                               accusation = data.get('meta', {}).get('accusation', [])
                               
                               if len(accusation) == 1:  # ä»…ä¿ç•™ accusation åˆ—è¡¨é•¿åº¦ä¸º 1 çš„è¡Œ
                                   valid_lines.append(line + '\n')  # æ¢å¤æ¢è¡Œç¬¦ï¼ˆåŸæ–‡ä»¶å¯èƒ½æ¯è¡Œæœ«å°¾æœ‰æ¢è¡Œï¼‰
                               
                           except json.JSONDecodeError as e:
                               print(f"è§£æ JSON è¡Œæ—¶å‡ºé”™ï¼ˆæ–‡ä»¶: {file_path}, è¡Œ: {line[:50]}...ï¼‰: {e}")
                               continue  # è·³è¿‡è§£æå¤±è´¥çš„è¡Œ
   
                       # å†™å›æ–‡ä»¶ï¼ˆè¦†ç›–åŸæ–‡ä»¶ï¼‰
                       with open(file_path, 'w', encoding='utf-8') as f:
                           f.writelines(valid_lines)
                       print(f"æ–‡ä»¶ {file_path} å¤„ç†å®Œæˆï¼Œä¿ç•™ {len(valid_lines)} æ¡æœ‰æ•ˆæ•°æ®")
   
                   except Exception as e:
                       print(f"å¤„ç†æ–‡ä»¶ {file_path} æ—¶å‘ç”Ÿé”™è¯¯: {e}")
   
   if __name__ == "__main__":
       # è¯·å°†æ­¤å¤„æ›¿æ¢ä¸ºå®é™…æ–‡ä»¶å¤¹è·¯å¾„ï¼ˆä¾‹å¦‚ï¼š"D:/json_files"ï¼‰
       target_folder = "temp/trainset"
       clean_json_files(target_folder)
   ```

2. å¯¹åº”accusationå­—æ®µè¿˜å«æœ‰å½¢å¦‚â€œ[]()â€æ ·å¼çš„æ–‡å­—ï¼Œå¯åœ¨è®­ç»ƒæ—¶å»é™¤ã€‚

   `accu_clean = accu.translate(str.maketrans('', '', '[]ï¼ˆï¼‰ã€ã€‘'))`

3. ç½‘ä¸Šç»™å‡ºçš„accu.txtæœ‰202ä¸ªç½ªåï¼Œå®é™…æ•°æ®é›†å¯èƒ½ä¸åŒ…å«è¿™äº›ç½ªåï¼Œå¯åœ¨å®é™…è®­ç»ƒæ—¶å€™è¿›è¡ŒåŠ¨æ€åŠ è½½ç½ªåã€‚(è§train.pyçš„ä¸»å‡½æ•°)



### äºŒã€ç”Ÿæˆè¯å‘é‡

é€‰æ‹©å¼€æºçš„é¢„è®­ç»ƒæ¨¡å‹ï¼Œç”±[å“ˆå°”æ»¨å·¥ä¸šå¤§å­¦ä¸“é—¨ä¸ºä¸­æ–‡æ³•å¾‹æ–‡æœ¬è®­ç»ƒçš„è¯å‘é‡ç”Ÿæˆæ¨¡å‹](https://huggingface.co/hfl/chinese-legal-electra-base-discriminator/tree/main)

```powershell
git lfs install
git clone https://huggingface.co/hfl/chinese-legal-electra-base-discriminator
```



### ä¸‰ã€ç¥ç»ç½‘ç»œå±‚æ„å»º

åŸºæœ¬åŸç†æ˜¯ä½¿ç”¨å·ç§¯ç¥ç»ç½‘ç»œæå–æ–‡æœ¬ç‰¹å¾ï¼Œç„¶åä½¿ç”¨GlobalMaxPoolingèšåˆæœ€æ˜¾è‘—çš„ç‰¹å¾äº¤ç»™å…¨è¿æ¥å±‚ï¼Œå…¨è¿æ¥å±‚æŠŠåˆšåˆš CNN æå–åˆ°çš„â€œæœ€æ˜¾è‘—ç‰¹å¾â€å½“ä½œè¾“å…¥ï¼Œäº¤ç»™ç¥ç»ç½‘ç»œé‡Œçš„å†³ç­–å±‚ï¼Œæœ€ç»ˆå…¨è¿æ¥å±‚æŠŠè¿™äº›ç‰¹å¾æ˜ å°„æˆä¸åŒç½ªåçš„å¯èƒ½æ€§ï¼Œäº¤ç»™Softmaxå±‚ã€‚Softmaxå±‚æŠŠæ‰€æœ‰ç½ªåçš„åˆ†æ•°ï¼Œå˜æˆ **æ¦‚ç‡åˆ†å¸ƒ**ï¼Œæœ€åé€‰å‡ºæ¦‚ç‡æœ€å¤§çš„ç½ªåã€‚



### å››ã€è®­ç»ƒæ¨¡å‹

è€ƒè™‘åˆ°æ—¶é—´ç´§è¿«å’Œç®—åŠ›é—®é¢˜ï¼Œæœ€ç»ˆåªä»200å¤šä¸‡æ¡æ•°æ®é›†ä¸­é€‰æ‹©äº†50ä¸‡æ¡ï¼Œè¿›è¡Œäº†1è½®è®­ç»ƒï¼Œå°æ ·æœ¬è®­ç»ƒæµ‹è¯•å‘ç°å¦‚æœè¿›è¡Œå¤šè½®è®­ç»ƒæ¨¡å‹å‘ç”Ÿäº†è¿‡æ‹Ÿåˆé—®é¢˜ï¼Œç²¾ç¡®ç‡ä¸æ–­ä¸‹é™ï¼Œä¸æ¸…æ¥šä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™æ ·çš„é—®é¢˜ï¼Œæœ€ç»ˆå†³å®šè¿›è¡Œä¸€è½®è®­ç»ƒï¼Œå¹³å‡ç²¾åº¦è¾¾åˆ°80%ï¼Œæˆ–è®¸æ·±å…¥äº†è§£æ¨¡å‹æ€§èƒ½ä¸‹é™çš„åŸå› åå¯ä»¥æ›´é«˜çš„æå‡ç²¾åº¦ã€‚è®­ç»ƒä»£ç å¦‚ä¸‹ï¼š

`train.py`

```python
import json
import os
os.environ['TF_GPU_THREAD_MODE'] = 'gpu_private'
os.environ['TF_ENABLE_CUBLAS_TENSOR_OP_MATH_FP32'] = '1'
os.environ['TF_ENABLE_CUDNN_TENSOR_OP_MATH_FP32'] = '1'
os.environ['TF_CPP_MIN_LOG_LEVEL'] = '2'

import sys
import logging
import numpy as np
import tensorflow as tf
from transformers import ElectraTokenizer, TFElectraModel
from tensorflow.keras import layers, Model
from tensorflow.keras import callbacks as keras_callbacks
from sklearn.metrics import classification_report
from sklearn.model_selection import train_test_split
from tqdm.auto import tqdm

# é…ç½®å‚æ•° 
MAX_LENGTH = 256
BATCH_SIZE = 10
EPOCHS = 1
LEARNING_RATE = 2e-5
MODEL_SAVE_PATH = "electra_cnn_legal"
DROPOUT_RATE = 0.3
CLASSIFIER_UNITS = 384
LOCAL_MODEL_PATH = "./hfl/chinese-legal-electra-base-disc"

# GPUé…ç½® 
gpus = tf.config.list_physical_devices('GPU')
if gpus:
    try:
        tf.config.set_logical_device_configuration(
            gpus[0],
            [tf.config.LogicalDeviceConfiguration(memory_limit=7 * 1024)]
        )
        tf.config.experimental.set_memory_growth(gpus[0], True)
    except RuntimeError as e:
        logging.warning(f"GPUé…ç½®æç¤º: {str(e)}")

# åŠ è½½ELECTRAæ¨¡å‹
try:
    tokenizer = ElectraTokenizer.from_pretrained(LOCAL_MODEL_PATH)
    electra_model = TFElectraModel.from_pretrained(LOCAL_MODEL_PATH)
    logging.info("ELECTRAæ¨¡å‹åŠ è½½æˆåŠŸ")
except Exception as e:
    logging.error(f"æ¨¡å‹åŠ è½½å¤±è´¥: {str(e)}")
    sys.exit(1)

# æ•°æ®ç”Ÿæˆå™¨
class LegalDataGenerator(tf.keras.utils.Sequence):
    def __init__(self, texts, labels, label_map, batch_size=BATCH_SIZE):
        self.texts = texts
        self.labels = np.array([label_map[l] for l in labels], dtype=np.int32)
        self.batch_size = batch_size

    def __len__(self):
        return int(np.ceil(len(self.texts) / self.batch_size))

    def __getitem__(self, idx):
        batch_texts = self.texts[idx * self.batch_size:(idx + 1) * self.batch_size]
        tokenized = tokenizer(
            batch_texts,
            max_length=MAX_LENGTH,
            padding="max_length",
            truncation=True,
            return_tensors="tf"
        )
        return (tokenized["input_ids"], tokenized["attention_mask"]), self.labels[idx * self.batch_size:(idx + 1) * self.batch_size]

# è‡ªå®šä¹‰æ¨¡å‹ 
class LegalClassifier(Model):
    def __init__(self, num_classes, **kwargs):
        super().__init__(**kwargs)
        self.electra = electra_model
        self.conv1 = layers.Conv1D(128, 3, activation='gelu', kernel_regularizer=tf.keras.regularizers.l2(1e-4))
        self.bn = layers.BatchNormalization()
        self.pool = layers.GlobalMaxPooling1D()
        self.classifier = layers.Dense(num_classes, activation='softmax')

    def call(self, inputs):
        input_ids, attention_mask = inputs
        outputs = self.electra(input_ids, attention_mask=attention_mask)
        x = outputs.last_hidden_state
        x = self.conv1(x)
        x = self.bn(x)
        x = self.pool(x)
        return self.classifier(x)

    def get_config(self):
        return {"num_classes": self.classifier.units}

    @classmethod
    def from_config(cls, config):
        return cls(**config)

# åŠ è½½æ•°æ®é›†
def load_dataset(data_dirs, label_map, min_samples_per_class=2):
    texts, labels = [], []
    label_counts = {label: 0 for label in label_map}

    for data_dir in data_dirs:
        if not os.path.isdir(data_dir):
            continue
        for root, _, files in os.walk(data_dir):
            for file in files:
                if not file.endswith('.json'):
                    continue
                try:
                    with open(os.path.join(root, file), 'r', encoding='utf-8') as f:
                        for line in f:
                            data = json.loads(line)
                            accu = data['meta']['accusation'][0]
                            accu_clean = accu.translate(str.maketrans('', '', '[]ï¼ˆï¼‰ã€ã€‘'))
                            if accu_clean in label_map and 10 < len(data['fact']) < 1500:
                                texts.append(data['fact'].strip())
                                labels.append(accu_clean)
                                label_counts[accu_clean] += 1
                except Exception as e:
                    logging.error(f"æ–‡ä»¶å¤„ç†é”™è¯¯: {str(e)}")

    # è¿‡æ»¤æ‰æ ·æœ¬æ•°ä¸è¶³çš„ç±»åˆ«
    texts = [text for i, text in enumerate(texts) if label_counts[labels[i]] >= min_samples_per_class]
    labels = [label for label in labels if label_counts[label] >= min_samples_per_class]

    logging.info(f"è¿‡æ»¤åæ•°æ® - æ€»æ ·æœ¬æ•°: {len(texts)}")
    return texts, labels

# ä¸»æµç¨‹ 
def main():
    logging.basicConfig(
        level=logging.INFO,
        format='%(asctime)s - %(levelname)s - %(message)s',
        handlers=[logging.FileHandler('training.log'), logging.StreamHandler()]
    )

    data_dirs = ["trainset"]
    try:
        # ç¬¬ä¸€æ­¥ï¼šåˆæ­¥è¯»å–å…¨éƒ¨ç½ªåï¼Œæ„å»ºè®¡æ•°å™¨
        all_texts, all_labels = [], []
        label_counter = {}

        for data_dir in data_dirs:
            for root, _, files in os.walk(data_dir):
                for file in files:
                    if not file.endswith('.json'):
                        continue
                    try:
                        with open(os.path.join(root, file), 'r', encoding='utf-8') as f:
                            for line in f:
                                data = json.loads(line)
                                fact = data.get("fact", "").strip()
                                if not fact or not (10 < len(fact) < 1500):
                                    continue
                                accu_list = data["meta"].get("accusation", [])
                                if not accu_list:
                                    continue
                                accu = accu_list[0]
                                accu_clean = accu.translate(str.maketrans('', '', '[]ï¼ˆï¼‰ã€ã€‘'))
                                all_texts.append(fact)
                                all_labels.append(accu_clean)
                                label_counter[accu_clean] = label_counter.get(accu_clean, 0) + 1
                    except Exception as e:
                        logging.error(f"æ•°æ®è¯»å–é”™è¯¯: {str(e)}")

        # ç¬¬äºŒæ­¥ï¼šç­›é€‰å‡ºç°æ¬¡æ•° >= 2 çš„ç½ªåï¼Œæ„å»ºæ–°çš„ label_to_id æ˜ å°„
        valid_labels = {label for label, count in label_counter.items() if count >= 2}
        label_to_id = {label: idx for idx, label in enumerate(sorted(valid_labels))}
        id_to_label = {idx: label for label, idx in label_to_id.items()}
        logging.info(f"æœ‰æ•ˆç½ªåå…±è®¡: {len(label_to_id)} ç±»")

        # ä¿å­˜å®é™…åŠ è½½çš„ç½ªåæ˜ å°„æ ‡ç­¾ï¼Œæ–¹ä¾¿æ¨¡å‹é¢„æµ‹æ—¶è°ƒç”¨ã€‚
        with open("accu_indeed.txt", "w", encoding="utf-8") as f:
            for key in label_to_id:
                f.write(key + "\n")
        f.close()

        # ç¬¬ä¸‰æ­¥ï¼šå†æ¬¡è¿‡æ»¤æ•°æ®ï¼Œåªä¿ç•™æœ‰æ•ˆç½ªåçš„æ ·æœ¬
        texts = [t for i, t in enumerate(all_texts) if all_labels[i] in valid_labels]
        labels = [l for l in all_labels if l in valid_labels]

        # ç¬¬ä¸€å±‚åˆ’åˆ†ï¼štrain+val ä¸ testï¼ˆæµ‹è¯•é›†ä¸å‚ä¸ä»»ä½•è®­ç»ƒè¿‡ç¨‹ï¼‰
        train_val_texts, test_texts, train_val_labels, test_labels = train_test_split(
            texts, labels, test_size=0.10, stratify=labels, random_state=42
        )

        # ç¬¬äºŒå±‚åˆ’åˆ†ï¼šä» train_val ä¸­å†åˆ’åˆ†å‡ºéªŒè¯é›†
        train_texts, val_texts, train_labels, val_labels = train_test_split(
            train_val_texts, train_val_labels, test_size=0.15, stratify=train_val_labels, random_state=42
        )

        logging.info(f"è®­ç»ƒæ ·æœ¬: {len(train_texts)}, éªŒè¯æ ·æœ¬: {len(val_texts)}, æµ‹è¯•æ ·æœ¬: {len(test_texts)}")
    except Exception as e:
        logging.error(f"æ•°æ®é¢„å¤„ç†å¤±è´¥: {str(e)}")
        sys.exit(1)

    # æ¨¡å‹æ„å»ºå’Œè®­ç»ƒä¸å˜
    model = LegalClassifier(len(label_to_id))
    model.compile(
        optimizer=tf.keras.optimizers.Adam(LEARNING_RATE),
        loss="sparse_categorical_crossentropy",
        metrics=["accuracy"]
    )

    callbacks = [
        keras_callbacks.EarlyStopping(patience=3, monitor='val_accuracy'),
        keras_callbacks.ModelCheckpoint(MODEL_SAVE_PATH, save_best_only=True, save_format='tf')
    ]

    try:
        model.fit(
            LegalDataGenerator(train_texts, train_labels, label_to_id),
            validation_data=LegalDataGenerator(val_texts, val_labels, label_to_id),
            epochs=EPOCHS,
            callbacks=callbacks,
            verbose=1
        )
        tf.keras.models.save_model(model, MODEL_SAVE_PATH)
    except Exception as e:
        logging.error(f"è®­ç»ƒå¤±è´¥: {str(e)}")
        sys.exit(1)

    # æ¨¡å‹è¯„ä¼°éƒ¨åˆ†
    try:
        model = tf.keras.models.load_model(
            MODEL_SAVE_PATH,
            custom_objects={"LegalClassifier": LegalClassifier}
        )
        y_true, y_pred = [], []
        test_gen = LegalDataGenerator(test_texts, test_labels, label_to_id)

        for (inputs, labels) in test_gen:
            preds = model.predict(inputs)
            y_true.extend(labels)
            y_pred.extend(np.argmax(preds, axis=1))

        print(classification_report(
            y_true, y_pred,
            target_names=[id_to_label[i] for i in sorted(set(y_true))],  # âœ… åªè¯„ä¼°å®é™…å‡ºç°è¿‡çš„ç±»åˆ«
            digits=4
        ))
    except Exception as e:
        logging.error(f"è¯„ä¼°å¤±è´¥: {str(e)}")

if __name__ == "__main__":
    main()

```



## è®­ç»ƒç»“æœè¯„ä¼°æŠ¥å‘Š

### æ³•å¾‹ç½ªååˆ†ç±»æ¨¡å‹æµ‹è¯•é›†è¯„ä¼°æŠ¥å‘Š

**ä¸€ã€æ•´ä½“æ€§èƒ½æ¦‚è§ˆ**

| æŒ‡æ ‡          | æ•°å€¼    | è§£é‡Šè¯´æ˜                                                                 |
|---------------|--------|--------------------------------------------------------------------------|
| æµ‹è¯•é›†å‡†ç¡®ç‡   | 88.47% | æ¨¡å‹å¯¹å¤§éƒ¨åˆ†æ ·æœ¬çš„ç½ªååˆ†ç±»æ­£ç¡®ï¼Œä½†å—é«˜é¢‘ç±»åˆ«ä¸»å¯¼                         |
| åŠ æƒå¹³å‡F1     | 0.8772 | é«˜é¢‘ç±»åˆ«ï¼ˆå¦‚ç›—çªƒã€å±é™©é©¾é©¶ï¼‰çš„ä¼˜ç§€è¡¨ç°æ‹‰é«˜æ•´ä½“è¯„åˆ†                       |
| å®è§‚å¹³å‡F1     | 0.5890 | åæ˜ å°æ ·æœ¬ç±»åˆ«çš„é¢„æµ‹èƒ½åŠ›ä¸¥é‡ä¸è¶³ï¼Œå­˜åœ¨æ˜¾è‘—çš„ç±»åˆ«ä¸å¹³è¡¡é—®é¢˜               |

---

**äºŒã€ç±»åˆ«åˆ†å¸ƒç‰¹å¾åˆ†æ**

1. **æç«¯é•¿å°¾åˆ†å¸ƒ**
   
   - **å¤´éƒ¨ç±»åˆ«**ï¼šå‰5%çš„ç½ªåï¼ˆå¦‚`ç›—çªƒ`ã€`å±é™©é©¾é©¶`ï¼‰å æ®æ€»æ ·æœ¬é‡çš„42.3%  
   - **å°¾éƒ¨ç±»åˆ«**ï¼š68ä¸ªç½ªåï¼ˆå ç±»åˆ«æ€»æ•°çš„39.5%ï¼‰æ ·æœ¬é‡ â‰¤ 10ï¼Œå…¶ä¸­23ä¸ªç±»åˆ«æ ·æœ¬é‡=1
   
2. **é«˜é¢‘ä¸ä½é¢‘ç±»åˆ«å¯¹æ¯”**
   | ç±»åˆ«ç±»å‹ | å¹³å‡æ ·æœ¬é‡ | å¹³å‡F1  | å…¸å‹ç½ªåæ¡ˆä¾‹                     |
   |----------|------------|---------|----------------------------------|
   | é«˜é¢‘ç±»åˆ« | 1,892      | 0.913   | ç›—çªƒï¼ˆ5436ï¼‰ã€å±é™©é©¾é©¶ï¼ˆ4876ï¼‰    |
   | ä¸­é¢‘ç±»åˆ« | 127        | 0.721   | åˆåŒè¯ˆéª—ï¼ˆ318ï¼‰ã€å—è´¿ï¼ˆ346ï¼‰      |
   | ä½é¢‘ç±»åˆ« | 5.2        | 0.107   | ä¼ æˆçŠ¯ç½ªæ–¹æ³•ï¼ˆ5ï¼‰ã€ä¼ªé€ è´§å¸ï¼ˆ4ï¼‰   |

---

**ä¸‰ã€å…³é”®ç½ªåè¡¨ç°è¯¦æ**

1. **é«˜é¢‘ç½ªåä¼˜ç§€æ¡ˆä¾‹**
   | ç½ªå             | æ ·æœ¬é‡ | Precision | Recall | F1   |
   |------------------|--------|-----------|--------|------|
   | ç›—çªƒ             | 5436   | 0.9589    | 0.9827 | 0.9707 |
   | å±é™©é©¾é©¶         | 4876   | 0.9751    | 0.9941 | 0.9845 |
   | æ•…æ„ä¼¤å®³         | 2897   | 0.8902    | 0.9203 | 0.9050 |

   **æˆåŠŸç‰¹å¾**ï¼šæ–‡æœ¬æ¨¡å¼æ˜ç¡®ï¼ˆå¦‚"ç›—çªƒ"å¸¸å«"è´¢ç‰©ä¸¢å¤±"ç­‰å…³é”®è¯ï¼‰ï¼Œæ ·æœ¬å……è¶³

2. **ä½é¢‘ç½ªåå¤±æ•ˆæ¡ˆä¾‹**
   | ç½ªå                     | æ ·æœ¬é‡ | Precision | Recall | F1   |
   |--------------------------|--------|-----------|--------|------|
   | ä¼ æˆçŠ¯ç½ªæ–¹æ³•             | 5      | 0.0000    | 0.0000 | 0.0000 |
   | ä¼ªé€ è´§å¸                 | 4      | 0.0000    | 0.0000 | 0.0000 |
   | ç»„ç»‡ã€é¢†å¯¼ã€å‚åŠ é»‘ç¤¾ä¼šæ€§è´¨ç»„ç»‡ | 1      | 0.0000    | 0.0000 | 0.0000 |

   **å¤±æ•ˆåŸå› **ï¼šæ ·æœ¬é‡è¿‡å°‘å¯¼è‡´æ¨¡å‹æ— æ³•å­¦ä¹ æœ‰æ•ˆç‰¹å¾ï¼Œé¢„æµ‹ç»“æœå…¨ä¸ºè´Ÿç±»

3. **ä¸­ç­‰æ ·æœ¬é‡ä½†è¡¨ç°å¼‚å¸¸çš„ç½ªå**
   | ç½ªå             | æ ·æœ¬é‡ | Precision | Recall | F1   | å¼‚å¸¸åŸå› åˆ†æ                     |
   |------------------|--------|-----------|--------|------|----------------------------------|
   | å‡ºå”®ã€è´­ä¹°ã€è¿è¾“å‡å¸ | 32     | 0.4638    | 1.0000 | 0.6337 | é«˜å¬å›ç‡ä¼´éšä½ç²¾ç¡®ç‡ï¼Œå­˜åœ¨è¯¯åˆ¤æ‰©æ•£ |
   | æŠ•æ”¾å±é™©ç‰©è´¨     | 59     | 0.6374    | 0.9831 | 0.7733 | å¬å›ç‡æ¥è¿‘å®Œç¾ä½†ç²¾ç¡®ç‡ä¸€èˆ¬         |

---

**å››ã€æ•°æ®è´¨é‡é£é™©æç¤º**

1. **æ ·æœ¬è¿‡æ»¤ç¼ºé™·**  
   - æµ‹è¯•é›†ä¸­åŒ…å«**41ä¸ªç½ªå**çš„æ ·æœ¬é‡ â‰¤ 3ï¼Œè¿åæœºå™¨å­¦ä¹ æœ€å°æ ·æœ¬åŸåˆ™  
   - ä¾‹å¦‚`ç»„ç»‡ã€é¢†å¯¼ã€å‚åŠ é»‘ç¤¾ä¼šæ€§è´¨ç»„ç»‡`ï¼ˆ1æ ·æœ¬ï¼‰åœ¨æµ‹è¯•é›†å‡ºç°ï¼Œå¯¼è‡´è¯„ä¼°æŒ‡æ ‡å¤±çœŸ

2. **æ ‡ç­¾å™ªå£°é£é™©**  
   - ç½ªå`ä¼ªé€ ã€å€’å–ä¼ªé€ çš„æœ‰ä»·ç¥¨è¯`ï¼ˆ5æ ·æœ¬ï¼‰ä¸`ä¼ªé€ è´§å¸`ï¼ˆ4æ ·æœ¬ï¼‰ç‰¹å¾é«˜åº¦ç›¸ä¼¼ä½†è¢«åˆ’åˆ†ä¸ºä¸åŒç±»åˆ«ï¼Œå¯èƒ½é€ æˆæ¨¡å‹æ··æ·†

3. **æ–‡æœ¬é•¿åº¦åå·®**  
   - è¿‡æ»¤æ¡ä»¶`10 < len(fact) < 1500`æ’é™¤è¶…çŸ­/è¶…é•¿æ–‡æœ¬ï¼Œä½†å®é™…ä¸šåŠ¡ä¸­éœ€éªŒè¯è¯¥é•¿åº¦èŒƒå›´æ˜¯å¦è¦†ç›–æ‰€æœ‰æ³•å¾‹åœºæ™¯

---

**äº”ã€æ³•å¾‹åœºæ™¯å…³é”®ç¼ºé™·**

1. **é‡å¤§ç½ªåæ¼æ£€é£é™©**  
   - `æ•…æ„æ€äºº`ï¼ˆ325æ ·æœ¬ï¼‰F1ä»…0.7457ï¼Œå¯¹é‡åˆ‘å…³é”®ç½ªåéœ€æ›´é«˜å¬å›ç‡  
   - `å—è´¿`ï¼ˆ346æ ·æœ¬ï¼‰ç²¾ç¡®ç‡0.8116ï¼Œå­˜åœ¨å°†å…¶ä»–ç»æµçŠ¯ç½ªè¯¯åˆ¤ä¸ºå—è´¿çš„é£é™©

2. **ç¨‹åºæ€§ç½ªåè¯†åˆ«ä¸è¶³**  
   - `å¦¨å®³ä½œè¯`ï¼ˆ22æ ·æœ¬ï¼‰F1ä»…0.5098ï¼Œå½±å“æ¡ˆä»¶ä¾¦ç ´ä¸­å…³é”®è¯æ®é“¾çš„æ„å»º  
   - `å¸®åŠ©æ¯ç­ã€ä¼ªé€ è¯æ®`ï¼ˆ9æ ·æœ¬ï¼‰å®Œå…¨æ— æ³•è¯†åˆ«ï¼Œå­˜åœ¨æ³•å¾‹ç¨‹åºæ¼æ´

---

**å…­ã€è¯„ä¼°ç»“è®º**

1. **ä¼˜åŠ¿é¢†åŸŸ**  
   - é«˜é¢‘ç½ªåï¼ˆæ ·æœ¬é‡ > 500ï¼‰åˆ†ç±»å‡†ç¡®ç‡ç¨³å®šåœ¨90%ä»¥ä¸Š  
   - ç‰¹å®šç½ªåï¼ˆå¦‚`ç›—çªƒ`ã€`å±é™©é©¾é©¶`ï¼‰è¾¾åˆ°å‡†ç”Ÿäº§ç¯å¢ƒå¯ç”¨æ°´å¹³

2. **æ ¸å¿ƒç“¶é¢ˆ**  
   - ç±»åˆ«æåº¦ä¸å¹³è¡¡å¯¼è‡´38.2%çš„ç½ªåæ— æ³•æœ‰æ•ˆè¯†åˆ«  
   - å…³é”®æ³•å¾‹ç½ªåï¼ˆæ ·æœ¬é‡50~300åŒºé—´ï¼‰å­˜åœ¨ç²¾ç¡®ç‡-å¬å›ç‡å¤±è¡¡é—®é¢˜

3. **ä¸šåŠ¡å½±å“**  
   - å½“å‰æ¨¡å‹é€‚ç”¨äºé«˜é¢‘ç½ªåçš„æ‰¹é‡å¤„ç†ï¼Œä½†**ä¸æ»¡è¶³å¸æ³•è£åˆ¤åœºæ™¯çš„å…¨é¢æ€§è¦æ±‚**  
   - å¯¹æ–°å‹çŠ¯ç½ªï¼ˆä½é¢‘ç½ªåï¼‰å’Œå¤åˆå‹çŠ¯ç½ªï¼ˆç‰¹å¾äº¤å‰ç½ªåï¼‰è¯†åˆ«èƒ½åŠ›æœ‰é™



### æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„è¡¨ç°è¡¨æ ¼æ±‡æ€»

|                             ç±»åˆ«                            |   precision |    recall |  f1-score |   support |
|------------------------------------------------------------|------------|-----------|-----------|-----------|
| ä¸²é€šæŠ•æ ‡                                                   |     0.7500 |    0.9000 |    0.8182 |        20 |
| äº¤é€šè‚‡äº‹                                                   |     0.9486 |    0.9728 |    0.9606 |      2392 |
| ä»‹ç»è´¿èµ‚                                                   |     0.0000 |    0.0000 |    0.0000 |        22 |
| ä»¥å±é™©æ–¹æ³•å±å®³å…¬å…±å®‰å…¨                                     |     0.7679 |    0.3116 |    0.4433 |       138 |
| ä¼ æˆçŠ¯ç½ªæ–¹æ³•                                               |     0.0000 |    0.0000 |    0.0000 |         5 |
| ä¼ æ’­æ€§ç—…                                                   |     1.0000 |    0.8333 |    0.9091 |        12 |
| ä¼ªè¯                                                       |     0.0000 |    0.0000 |    0.0000 |        20 |
| ä¼ªé€ ã€å€’å–ä¼ªé€ çš„æœ‰ä»·ç¥¨è¯                                   |     0.0000 |    0.0000 |    0.0000 |         5 |
| ä¼ªé€ ã€å˜é€ ã€ä¹°å–å›½å®¶æœºå…³å…¬æ–‡ã€è¯ä»¶ã€å°ç«                    |     0.8089 |    0.8728 |    0.8397 |       228 |
| ä¼ªé€ ã€å˜é€ ã€ä¹°å–æ­¦è£…éƒ¨é˜Ÿå…¬æ–‡ã€è¯ä»¶ã€å°ç«                    |     1.0000 |    0.5714 |    0.7273 |         7 |
| ä¼ªé€ ã€å˜é€ å±…æ°‘èº«ä»½è¯                                       |     0.8485 |    0.7778 |    0.8116 |        36 |
| ä¼ªé€ ã€å˜é€ é‡‘èç¥¨è¯                                         |     0.8947 |    0.6296 |    0.7391 |        27 |
| ä¼ªé€ å…¬å¸ã€ä¼ä¸šã€äº‹ä¸šå•ä½ã€äººæ°‘å›¢ä½“å°ç«                      |     0.9108 |    0.8291 |    0.8680 |       234 |
| ä¼ªé€ è´§å¸                                                   |     0.0000 |    0.0000 |    0.0000 |         4 |
| ä¾®è¾±                                                       |     0.0000 |    0.0000 |    0.0000 |         8 |
| ä¾µå                                                        |     0.0000 |    0.0000 |    0.0000 |        13 |
| ä¾µçŠ¯è‘—ä½œæƒ                                                 |     0.9636 |    0.8833 |    0.9217 |        60 |
| ä¿é™©è¯ˆéª—                                                   |     0.8889 |    0.8696 |    0.8791 |        46 |
| ä¿¡ç”¨å¡è¯ˆéª—                                                 |     0.8546 |    0.9158 |    0.8841 |       475 |
| å€’å–æ–‡ç‰©                                                   |     0.0000 |    0.0000 |    0.0000 |         3 |
| å€’å–è½¦ç¥¨ã€èˆ¹ç¥¨                                             |     1.0000 |    1.0000 |    1.0000 |         4 |
| å‡å†’æ³¨å†Œå•†æ ‡                                               |     0.7831 |    0.9205 |    0.8463 |       302 |
| å†’å……å†›äººæ‹›æ‘‡æ’éª—                                           |     0.8000 |    0.9697 |    0.8767 |        33 |
| å‡ºå”®ã€è´­ä¹°ã€è¿è¾“å‡å¸                                       |     0.4638 |    1.0000 |    0.6337 |        32 |
| åˆ©ç”¨å½±å“åŠ›å—è´¿                                             |     0.0000 |    0.0000 |    0.0000 |        11 |
| åˆ¶ä½œã€å¤åˆ¶ã€å‡ºç‰ˆã€è´©å–ã€ä¼ æ’­æ·«ç§½ç‰©å“ç‰Ÿåˆ©                   |     0.9583 |    0.9583 |    0.9583 |        24 |
| åˆ¶é€ ã€è´©å–ã€ä¼ æ’­æ·«ç§½ç‰©å“                                   |     0.0000 |    0.0000 |    0.0000 |         1 |
| åŠ¨æ¤ç‰©æ£€ç–«å¾‡ç§èˆå¼Š                                         |     0.9231 |    0.8000 |    0.8571 |        15 |
| åŠ«æŒèˆ¹åªã€æ±½è½¦                                             |     0.0000 |    0.0000 |    0.0000 |         3 |
| å•ä½å—è´¿                                                   |     0.2500 |    0.0476 |    0.0800 |        21 |
| å•ä½è¡Œè´¿                                                   |     0.7068 |    0.7627 |    0.7337 |       177 |
| å±é™©ç‰©å“è‚‡äº‹                                               |     1.0000 |    0.1250 |    0.2222 |         8 |
| å±é™©é©¾é©¶                                                   |     0.9751 |    0.9941 |    0.9845 |      4876 |
| å—è´¿                                                       |     0.8116 |    0.6850 |    0.7429 |       346 |
| åˆåŒè¯ˆéª—                                                   |     0.6676 |    0.7201 |    0.6929 |       318 |
| å¤±ç«                                                       |     0.9717 |    0.9778 |    0.9748 |       316 |
| å¦¨å®³ä½œè¯                                                   |     0.4483 |    0.5909 |    0.5098 |        22 |
| å¦¨å®³ä¿¡ç”¨å¡ç®¡ç†                                             |     0.9058 |    0.8929 |    0.8993 |       140 |
| å¦¨å®³å…¬åŠ¡                                                   |     0.8929 |    0.9646 |    0.9274 |       311 |
| å®¹ç•™ä»–äººå¸æ¯’                                               |     0.9646 |    0.9745 |    0.9695 |       392 |
| å¯¹å•ä½è¡Œè´¿                                                 |     0.0000 |    0.0000 |    0.0000 |        20 |
| å¯¹éå›½å®¶å·¥ä½œäººå‘˜è¡Œè´¿                                       |     0.7500 |    0.1579 |    0.2609 |        38 |
| å¯»è¡…æ»‹äº‹                                                   |     0.7706 |    0.5091 |    0.6131 |       607 |
| å¸®åŠ©æ¯ç­ã€ä¼ªé€ è¯æ®                                         |     0.0000 |    0.0000 |    0.0000 |         9 |
| å¸®åŠ©çŠ¯ç½ªåˆ†å­é€ƒé¿å¤„ç½š                                       |     0.5600 |    0.7778 |    0.6512 |        18 |
| å¼€è®¾èµŒåœº                                                   |     0.8465 |    0.9259 |    0.8844 |       405 |
| å¼•è¯±ã€æ•™å”†ã€æ¬ºéª—ä»–äººå¸æ¯’                                   |     1.0000 |    0.6000 |    0.7500 |        15 |
| å¼ºåˆ¶çŒ¥äºµã€ä¾®è¾±å¦‡å¥³                                         |     0.7436 |    0.5686 |    0.6444 |        51 |
| å¼ºå¥¸                                                       |     0.8846 |    0.9485 |    0.9154 |       291 |
| å¼ºè¿«äº¤æ˜“                                                   |     0.5625 |    0.6429 |    0.6000 |        28 |
| å¼ºè¿«ä»–äººå¸æ¯’                                               |     0.0000 |    0.0000 |    0.0000 |         2 |
| å¼ºè¿«åŠ³åŠ¨                                                   |     0.6667 |    0.4000 |    0.5000 |         5 |
| å¾‡ç§æ‰æ³•                                                   |     0.0000 |    0.0000 |    0.0000 |        14 |
| å¾‡ç§èˆå¼Šä¸ç§»äº¤åˆ‘äº‹æ¡ˆä»¶                                     |     0.0000 |    0.0000 |    0.0000 |         5 |
| æ‰“å‡»æŠ¥å¤è¯äºº                                               |     0.0000 |    0.0000 |    0.0000 |         3 |
| æ‰°ä¹±æ— çº¿ç”µé€šè®¯ç®¡ç†ç§©åº                                     |     1.0000 |    0.0159 |    0.0312 |        63 |
| æŠ•æ”¾å±é™©ç‰©è´¨                                               |     0.6374 |    0.9831 |    0.7733 |        59 |
| æŠ¢åŠ«                                                       |     0.8310 |    0.7804 |    0.8049 |       378 |
| æŠ¢å¤º                                                       |     0.7442 |    0.9195 |    0.8226 |       174 |
| æ‹å–å¦‡å¥³ã€å„¿ç«¥                                             |     0.8205 |    0.9600 |    0.8848 |       100 |
| æ‹éª—å„¿ç«¥                                                   |     0.7647 |    0.6190 |    0.6842 |        21 |
| æ‹’ä¸æ‰§è¡Œåˆ¤å†³ã€è£å®š                                         |     0.8609 |    0.9636 |    0.9094 |       302 |
| æ‹’ä¸æ”¯ä»˜åŠ³åŠ¨æŠ¥é…¬                                           |     0.9601 |    0.9779 |    0.9689 |       271 |
| æ‹›æ‘‡æ’éª—                                                   |     0.7975 |    0.8690 |    0.8317 |       145 |
| æ‹›æ”¶å…¬åŠ¡å‘˜ã€å­¦ç”Ÿå¾‡ç§èˆå¼Š                                   |     0.0000 |    0.0000 |    0.0000 |         7 |
| æŒæœ‰ã€ä½¿ç”¨å‡å¸                                             |     1.0000 |    0.2778 |    0.4348 |        54 |
| æŒæœ‰ä¼ªé€ çš„å‘ç¥¨                                             |     0.8276 |    0.8780 |    0.8521 |        82 |
| æŒªç”¨å…¬æ¬¾                                                   |     0.8529 |    0.7500 |    0.7982 |       232 |
| æŒªç”¨ç‰¹å®šæ¬¾ç‰©                                               |     0.0000 |    0.0000 |    0.0000 |         4 |
| æŒªç”¨èµ„é‡‘                                                   |     0.7773 |    0.7500 |    0.7634 |       256 |
| æ©é¥°ã€éšç’çŠ¯ç½ªæ‰€å¾—ã€çŠ¯ç½ªæ‰€å¾—æ”¶ç›Š                           |     0.9096 |    0.7295 |    0.8097 |       207 |
| æä¾›ä¾µå…¥ã€éæ³•æ§åˆ¶è®¡ç®—æœºä¿¡æ¯ç³»ç»Ÿç¨‹åºã€å·¥å…·                   |     0.0000 |    0.0000 |    0.0000 |         4 |
| æ”¶ä¹°è¢«æ‹å–çš„å¦‡å¥³ã€å„¿ç«¥                                     |     0.0000 |    0.0000 |    0.0000 |         6 |
| æ”¾ç«                                                       |     0.7898 |    0.9288 |    0.8537 |       267 |
| æ•…æ„ä¼¤å®³                                                   |     0.8902 |    0.9203 |    0.9050 |      2897 |
| æ•…æ„æ€äºº                                                   |     0.7563 |    0.7354 |    0.7457 |       325 |
| æ•…æ„æ¯åè´¢ç‰©                                               |     0.7109 |    0.7085 |    0.7097 |       295 |
| æ•²è¯ˆå‹’ç´¢                                                   |     0.8550 |    0.6867 |    0.7617 |       249 |
| æ±¡æŸ“ç¯å¢ƒ                                                   |     0.9933 |    0.9801 |    0.9867 |       302 |
| æ´—é’±                                                       |     0.0000 |    0.0000 |    0.0000 |         3 |
| æ»¥ä¼æ—æœ¨                                                   |     0.8348 |    0.9697 |    0.8972 |       396 |
| æ»¥ç”¨èŒæƒ                                                   |     0.6190 |    0.5306 |    0.5714 |       147 |
| çˆ†ç‚¸                                                       |     0.4583 |    0.2200 |    0.2973 |        50 |
| çŒ¥äºµå„¿ç«¥                                                   |     0.8167 |    0.8909 |    0.8522 |       110 |
| ç©å¿½èŒå®ˆ                                                   |     0.8174 |    0.8107 |    0.8140 |       243 |
| ç”Ÿäº§ã€é”€å”®ä¸ç¬¦åˆå®‰å…¨æ ‡å‡†çš„é£Ÿå“                             |     0.9091 |    0.8874 |    0.8981 |       293 |
| ç”Ÿäº§ã€é”€å”®ä¼ªåŠ£äº§å“                                         |     0.7568 |    0.4719 |    0.5813 |       178 |
| ç”Ÿäº§ã€é”€å”®ä¼ªåŠ£å†œè¯ã€å…½è¯ã€åŒ–è‚¥ã€ç§å­                       |     1.0000 |    0.2857 |    0.4444 |         7 |
| ç”Ÿäº§ã€é”€å”®å‡è¯                                             |     0.9734 |    0.9792 |    0.9763 |       336 |
| ç”Ÿäº§ã€é”€å”®æœ‰æ¯’ã€æœ‰å®³é£Ÿå“                                   |     0.9118 |    0.9058 |    0.9088 |       308 |
| ç›—ä¼æ—æœ¨                                                   |     0.9119 |    0.7500 |    0.8231 |       276 |
| ç›—æ˜å¤æ–‡åŒ–é—å€ã€å¤å¢“è‘¬                                     |     1.0000 |    0.9804 |    0.9901 |        51 |
| ç›—çªƒ                                                       |     0.9589 |    0.9827 |    0.9707 |      5436 |
| ç›—çªƒã€ä¾®è¾±å°¸ä½“                                             |     1.0000 |    0.4286 |    0.6000 |         7 |
| ç ´åäº¤é€šå·¥å…·                                               |     0.0000 |    0.0000 |    0.0000 |         3 |
| ç ´åäº¤é€šè®¾æ–½                                               |     0.0000 |    0.0000 |    0.0000 |         8 |
| ç ´åå¹¿æ’­ç”µè§†è®¾æ–½ã€å…¬ç”¨ç”µä¿¡è®¾æ–½                             |     0.5542 |    0.9200 |    0.6917 |       100 |
| ç ´åæ˜“ç‡ƒæ˜“çˆ†è®¾å¤‡                                           |     0.9706 |    0.8462 |    0.9041 |        39 |
| ç ´åç”Ÿäº§ç»è¥                                               |     0.7071 |    0.6731 |    0.6897 |       104 |
| ç ´åç”µåŠ›è®¾å¤‡                                               |     0.9180 |    0.7778 |    0.8421 |        72 |
| ç ´åç›‘ç®¡ç§©åº                                               |     0.6000 |    0.9000 |    0.7200 |        10 |
| ç ´åè®¡ç®—æœºä¿¡æ¯ç³»ç»Ÿ                                         |     0.4000 |    0.1429 |    0.2105 |        14 |
| ç¥¨æ®è¯ˆéª—                                                   |     0.6316 |    0.7742 |    0.6957 |        31 |
| ç§åˆ†å›½æœ‰èµ„äº§                                               |     0.0000 |    0.0000 |    0.0000 |        12 |
| çªƒå–ã€æ”¶ä¹°ã€éæ³•æä¾›ä¿¡ç”¨å¡ä¿¡æ¯                             |     0.0000 |    0.0000 |    0.0000 |         9 |
| çªè—ã€åŒ…åº‡                                                 |     0.8432 |    0.8361 |    0.8397 |       238 |
| çªè—ã€è½¬ç§»ã€æ”¶è´­ã€é”€å”®èµƒç‰©                                 |     0.2222 |    0.5000 |    0.3077 |         8 |
| çªè—ã€è½¬ç§»ã€éšç’æ¯’å“ã€æ¯’èµƒ                                 |     0.0000 |    0.0000 |    0.0000 |         3 |
| ç»„ç»‡ã€é¢†å¯¼ã€å‚åŠ é»‘ç¤¾ä¼šæ€§è´¨ç»„ç»‡                             |     0.0000 |    0.0000 |    0.0000 |         1 |
| ç»„ç»‡ã€é¢†å¯¼ä¼ é”€æ´»åŠ¨                                         |     0.9888 |    0.9565 |    0.9724 |       184 |
| ç»‘æ¶                                                       |     0.8364 |    0.5679 |    0.6765 |        81 |
| ç¼–é€ ã€æ•…æ„ä¼ æ’­è™šå‡ææ€–ä¿¡æ¯                                 |     0.6897 |    1.0000 |    0.8163 |        20 |
| èŒåŠ¡ä¾µå                                                    |     0.7276 |    0.8423 |    0.7807 |       279 |
| èšä¼—å†²å‡»å›½å®¶æœºå…³                                           |     0.0000 |    0.0000 |    0.0000 |         8 |
| èšä¼—å“„æŠ¢                                                   |     0.0000 |    0.0000 |    0.0000 |         3 |
| èšä¼—æ‰°ä¹±å…¬å…±åœºæ‰€ç§©åºã€äº¤é€šç§©åº                             |     0.8889 |    0.3077 |    0.4571 |        26 |
| èšä¼—æ‰°ä¹±ç¤¾ä¼šç§©åº                                           |     0.4421 |    0.9333 |    0.6000 |        45 |
| èšä¼—æ–—æ®´                                                   |     0.6192 |    0.7352 |    0.6722 |       219 |
| è„±é€ƒ                                                       |     0.7647 |    0.8125 |    0.7879 |        16 |
| è™å¾…                                                       |     0.0000 |    0.0000 |    0.0000 |         5 |
| è™å¾…è¢«ç›‘ç®¡äºº                                               |     0.0000 |    0.0000 |    0.0000 |         3 |
| è™šå¼€å‘ç¥¨                                                   |     0.8835 |    0.9010 |    0.8922 |       101 |
| è™šå¼€å¢å€¼ç¨ä¸“ç”¨å‘ç¥¨ã€ç”¨äºéª—å–å‡ºå£é€€ç¨ã€æŠµæ‰£ç¨æ¬¾å‘ç¥¨         |     0.9771 |    0.9739 |    0.9755 |       307 |
| è™šæŠ¥æ³¨å†Œèµ„æœ¬                                               |     0.6957 |    1.0000 |    0.8205 |        16 |
| è¡Œè´¿                                                       |     0.6677 |    0.8621 |    0.7525 |       261 |
| è¯ˆéª—                                                       |     0.8444 |    0.7830 |    0.8125 |       977 |
| è¯¬å‘Šé™·å®³                                                   |     0.6667 |    0.3571 |    0.4651 |        28 |
| è¯½è°¤                                                       |     0.0000 |    0.0000 |    0.0000 |         2 |
| è´ªæ±¡                                                       |     0.7799 |    0.7977 |    0.7887 |       262 |
| è´·æ¬¾è¯ˆéª—                                                   |     0.3333 |    0.0323 |    0.0588 |        31 |
| èµŒåš                                                       |     0.8092 |    0.7653 |    0.7866 |       277 |
| èµ°ç§                                                       |     0.0000 |    0.0000 |    0.0000 |         2 |
| èµ°ç§ã€è´©å–ã€è¿è¾“ã€åˆ¶é€ æ¯’å“                                 |     0.9704 |    0.9743 |    0.9723 |      2255 |
| èµ°ç§å›½å®¶ç¦æ­¢è¿›å‡ºå£çš„è´§ç‰©ã€ç‰©å“                             |     0.8750 |    0.8750 |    0.8750 |        16 |
| èµ°ç§åºŸç‰©                                                   |     1.0000 |    0.1667 |    0.2857 |         6 |
| èµ°ç§æ™®é€šè´§ç‰©ã€ç‰©å“                                         |     0.9184 |    0.9926 |    0.9541 |       136 |
| èµ°ç§æ­¦å™¨ã€å¼¹è¯                                             |     0.7692 |    1.0000 |    0.8696 |        10 |
| èµ°ç§çè´µåŠ¨ç‰©ã€çè´µåŠ¨ç‰©åˆ¶å“                                 |     0.7368 |    0.8750 |    0.8000 |        16 |
| è¿‡å¤±ä»¥å±é™©æ–¹æ³•å±å®³å…¬å…±å®‰å…¨                                 |     0.5143 |    0.8182 |    0.6316 |        22 |
| è¿‡å¤±æŠ•æ”¾å±é™©ç‰©è´¨                                           |     0.0000 |    0.0000 |    0.0000 |         6 |
| è¿‡å¤±æŸåå¹¿æ’­ç”µè§†è®¾æ–½ã€å…¬ç”¨ç”µä¿¡è®¾æ–½                         |     0.5000 |    0.8571 |    0.6316 |         7 |
| è¿‡å¤±æŸåæ­¦å™¨è£…å¤‡ã€å†›äº‹è®¾æ–½ã€å†›äº‹é€šä¿¡                       |     0.6000 |    0.7500 |    0.6667 |         4 |
| è¿‡å¤±è‡´äººæ­»äº¡                                               |     0.7908 |    0.4874 |    0.6031 |       318 |
| è¿‡å¤±è‡´äººé‡ä¼¤                                               |     0.6150 |    0.8092 |    0.6989 |       152 |
| è¿æ³•å‘æ”¾è´·æ¬¾                                               |     0.7778 |    0.9032 |    0.8358 |        31 |
| é€ƒç¨                                                       |     0.8636 |    0.8636 |    0.8636 |        22 |
| é—å¼ƒ                                                       |     0.9231 |    0.6000 |    0.7273 |        20 |
| é‡å¤§åŠ³åŠ¨å®‰å…¨äº‹æ•…                                           |     0.0000 |    0.0000 |    0.0000 |        60 |
| é‡å¤§è´£ä»»äº‹æ•…                                               |     0.6422 |    0.9091 |    0.7527 |       308 |
| é‡å©š                                                       |     0.9255 |    0.9886 |    0.9560 |        88 |
| é‡‘èå‡­è¯è¯ˆéª—                                               |     0.0000 |    0.0000 |    0.0000 |         3 |
| é”€å”®å‡å†’æ³¨å†Œå•†æ ‡çš„å•†å“                                     |     0.8147 |    0.9410 |    0.8733 |       271 |
| éšåŒ¿ã€æ•…æ„é”€æ¯ä¼šè®¡å‡­è¯ã€ä¼šè®¡å¸ç°¿ã€è´¢åŠ¡ä¼šè®¡æŠ¥å‘Š             |     0.7692 |    0.8333 |    0.8000 |        12 |
| é›†èµ„è¯ˆéª—                                                   |     0.6774 |    0.5060 |    0.5793 |        83 |
| éå›½å®¶å·¥ä½œäººå‘˜å—è´¿                                         |     0.6550 |    0.8008 |    0.7206 |       256 |
| éæ³•ä¹°å–ã€è¿è¾“ã€æºå¸¦ã€æŒæœ‰æ¯’å“åŸæ¤ç‰©ç§å­ã€å¹¼è‹—             |     0.0000 |    0.0000 |    0.0000 |         1 |
| éæ³•ä¹°å–åˆ¶æ¯’ç‰©å“                                           |     0.9200 |    0.7931 |    0.8519 |        29 |
| éæ³•ä¾µå…¥ä½å®…                                               |     0.7486 |    0.6782 |    0.7117 |       202 |
| éæ³•å‡ºå”®å‘ç¥¨                                               |     0.8000 |    0.7619 |    0.7805 |        21 |
| éæ³•åˆ¶é€ ã€ä¹°å–ã€è¿è¾“ã€å‚¨å­˜å±é™©ç‰©è´¨                         |     0.5714 |    0.5000 |    0.5333 |         8 |
| éæ³•åˆ¶é€ ã€ä¹°å–ã€è¿è¾“ã€é‚®å¯„ã€å‚¨å­˜æªæ”¯ã€å¼¹è¯ã€çˆ†ç‚¸ç‰©         |     0.8310 |    0.8806 |    0.8551 |       268 |
| éæ³•åˆ¶é€ ã€å‡ºå”®éæ³•åˆ¶é€ çš„å‘ç¥¨                               |     0.2500 |    0.0769 |    0.1176 |        13 |
| éæ³•åˆ¶é€ ã€é”€å”®éæ³•åˆ¶é€ çš„æ³¨å†Œå•†æ ‡æ ‡è¯†                       |     0.0000 |    0.0000 |    0.0000 |        10 |
| éæ³•å ç”¨å†œç”¨åœ°                                             |     0.9253 |    0.9670 |    0.9457 |       333 |
| éæ³•å¸æ”¶å…¬ä¼—å­˜æ¬¾                                           |     0.8423 |    0.9570 |    0.8960 |       279 |
| éæ³•å¤„ç½®æŸ¥å°ã€æ‰£æŠ¼ã€å†»ç»“çš„è´¢äº§                             |     0.8276 |    0.3934 |    0.5333 |        61 |
| éæ³•æ‹˜ç¦                                                   |     0.8144 |    0.8556 |    0.8345 |       277 |
| éæ³•æŒæœ‰ã€ç§è—æªæ”¯ã€å¼¹è¯                                   |     0.9185 |    0.9397 |    0.9290 |       348 |
| éæ³•æŒæœ‰æ¯’å“                                               |     0.8125 |    0.8206 |    0.8165 |       301 |
| éæ³•æ•ææ°´äº§å“                                             |     0.9852 |    0.9925 |    0.9888 |       134 |
| éæ³•æºå¸¦æªæ”¯ã€å¼¹è¯ã€ç®¡åˆ¶åˆ€å…·ã€å±é™©ç‰©å“å±åŠå…¬å…±å®‰å…¨         |     0.3333 |    0.0833 |    0.1333 |        12 |
| éæ³•æ”¶è´­ã€è¿è¾“ã€å‡ºå”®çè´µã€æ¿’å±é‡ç”ŸåŠ¨ç‰©ã€çè´µã€æ¿’å±é‡ç”ŸåŠ¨ç‰©åˆ¶å“ |     0.0000 |    0.0000 |    0.0000 |         3 |
| éæ³•æ”¶è´­ã€è¿è¾“ã€åŠ å·¥ã€å‡ºå”®å›½å®¶é‡ç‚¹ä¿æŠ¤æ¤ç‰©ã€å›½å®¶é‡ç‚¹ä¿æŠ¤æ¤ç‰©åˆ¶å“ |     0.8636 |    0.7451 |    0.8000 |        51 |
| éæ³•æ”¶è´­ã€è¿è¾“ç›—ä¼ã€æ»¥ä¼çš„æ—æœ¨                             |     0.8000 |    0.8276 |    0.8136 |        29 |
| éæ³•ç‹©çŒ                                                   |     0.9560 |    0.9016 |    0.9280 |       193 |
| éæ³•çŒæ•ã€æ€å®³çè´µã€æ¿’å±é‡ç”ŸåŠ¨ç‰©                           |     0.7234 |    0.7907 |    0.7556 |        43 |
| éæ³•ç”Ÿäº§ã€ä¹°å–è­¦ç”¨è£…å¤‡                                     |     1.0000 |    0.8571 |    0.9231 |         7 |
| éæ³•ç”Ÿäº§ã€é”€å”®é—´è°ä¸“ç”¨å™¨æ                                 |     0.7222 |    1.0000 |    0.8387 |        13 |
| éæ³•ç§æ¤æ¯’å“åŸæ¤ç‰©                                         |     1.0000 |    0.9941 |    0.9970 |       337 |
| éæ³•ç»„ç»‡å–è¡€                                               |     0.9091 |    1.0000 |    0.9524 |        10 |
| éæ³•ç»è¥                                                   |     0.8908 |    0.7361 |    0.8061 |       288 |
| éæ³•è·å–å…¬æ°‘ä¸ªäººä¿¡æ¯                                       |     0.9394 |    0.8378 |    0.8857 |        37 |
| éæ³•è·å–å›½å®¶ç§˜å¯†                                           |     0.5000 |    0.1667 |    0.2500 |         6 |
| éæ³•è¡ŒåŒ»                                                   |     0.9755 |    0.9789 |    0.9772 |       285 |
| éæ³•è½¬è®©ã€å€’å–åœŸåœ°ä½¿ç”¨æƒ                                   |     0.8864 |    0.7647 |    0.8211 |        51 |
| éæ³•è¿›è¡ŒèŠ‚è‚²æ‰‹æœ¯                                           |     1.0000 |    0.8182 |    0.9000 |        22 |
| éæ³•é‡‡ä¼ã€æ¯åå›½å®¶é‡ç‚¹ä¿æŠ¤æ¤ç‰©                             |     0.9077 |    0.9031 |    0.9054 |       196 |
| éæ³•é‡‡çŸ¿                                                   |     0.9739 |    0.9106 |    0.9412 |       123 |
| éª—å–è´·æ¬¾ã€ç¥¨æ®æ‰¿å…‘ã€é‡‘èç¥¨è¯                               |     0.8188 |    0.9457 |    8777 |       258 |
| é«˜åˆ©è½¬è´·                                                   |     0.0000 |    0.0000 |    0.0000 |         2 |
| â€‹**accuracy**â€‹                                               |             |           | â€‹**0.8847**|     39317 |
| â€‹**macro avg**â€‹                                              |     0.6260 |    0.5928 |    0.5890 |     39317 |
| â€‹**weighted avg**â€‹                                           |     0.8798 |    0.8847 |    0.8772 |     39317 |



## å®é™…æµ‹è¯•

ä½¿ç”¨ä»£ç 

```python
import os
import json
import numpy as np
import tensorflow as tf
from transformers import ElectraTokenizer, TFElectraModel
from tensorflow.keras import layers, Model

# é…ç½®
MAX_LENGTH = 256
MODEL_SAVE_PATH = "electra_cnn_legal"
LOCAL_MODEL_PATH = "./hfl/chinese-legal-electra-base-disc"

# åŠ è½½ tokenizer å’Œ electra æ¨¡å‹
tokenizer = ElectraTokenizer.from_pretrained(LOCAL_MODEL_PATH)
electra_model = TFElectraModel.from_pretrained(LOCAL_MODEL_PATH)

# å®šä¹‰æ¨¡å‹ç±»
class LegalClassifier(Model):
    def __init__(self, num_classes, **kwargs):
        super().__init__(**kwargs)
        self.electra = electra_model
        self.conv1 = layers.Conv1D(128, 3, activation='gelu', kernel_regularizer=tf.keras.regularizers.l2(1e-4))
        self.bn = layers.BatchNormalization()
        self.pool = layers.GlobalMaxPooling1D()
        self.classifier = layers.Dense(num_classes, activation='softmax')

    def call(self, inputs):
        input_ids, attention_mask = inputs
        outputs = self.electra(input_ids, attention_mask=attention_mask)
        x = outputs.last_hidden_state
        x = self.conv1(x)
        x = self.bn(x)
        x = self.pool(x)
        return self.classifier(x)

    def get_config(self):
        return {"num_classes": self.classifier.units}

    @classmethod
    def from_config(cls, config):
        return cls(**config)

# åŠ è½½ label æ˜ å°„å­—å…¸
with open("accu.txt", encoding="utf-8") as f:
    labels = [line.strip() for line in f.readlines()]
label_to_id = {label: i for i, label in enumerate(labels)}
id_to_label = {i: label for label, i in label_to_id.items()}

# åŠ è½½æ¨¡å‹
model = tf.keras.models.load_model(
    MODEL_SAVE_PATH,
    custom_objects={"LegalClassifier": LegalClassifier}
)

# é¢„æµ‹å‡½æ•°
def predict_accusation(text):
    if not text.strip():
        return "â—ï¸è¾“å…¥æ–‡æœ¬ä¸ºç©º"

    tokens = tokenizer(
        text,
        max_length=MAX_LENGTH,
        truncation=True,
        padding='max_length',
        return_tensors='tf'
    )
    input_ids = tokens["input_ids"]
    attention_mask = tokens["attention_mask"]

    preds = model.predict((input_ids, attention_mask))
    pred_id = np.argmax(preds, axis=1)[0]
    return id_to_label[pred_id]

# æ— é™å¾ªç¯é¢„æµ‹
if __name__ == "__main__":
    print("ğŸ” çŠ¯ç½ªäº‹å®ç½ªåé¢„æµ‹ç³»ç»Ÿ")
    print("è¾“å…¥çŠ¯ç½ªäº‹å®æ–‡æœ¬ï¼Œè¾“å…¥ 'Stop' å¯é€€å‡ºã€‚")
    while True:
        fact = input("\nè¯·è¾“å…¥çŠ¯ç½ªäº‹å®ï¼š\n>>> ")
        if fact.strip().lower() == "stop":
            print("ğŸ‘‹ å·²é€€å‡ºé¢„æµ‹ç³»ç»Ÿã€‚")
            break
        result = predict_accusation(fact)
        print(f"âœ… é¢„æµ‹ç½ªåï¼š{result}")

```

### æ•ˆæœå›¾

![åœ¨Â·](assets/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20250413144050.png)



![å¾®ä¿¡å›¾ç‰‡_20250413144235](assets/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20250413144235.png)



![å¾®ä¿¡å›¾ç‰‡_20250413144242](assets/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20250413144242.png)



![å¾®ä¿¡å›¾ç‰‡_20250413145119](assets/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20250413145119.png)





## å‚è€ƒæ–‡çŒ®

[åŸºäºBERTè¯å‘é‡å’ŒAttention-CNNçš„æ™ºèƒ½å¸æ³•ç ”ç©¶-å­¦ä½-ä¸‡æ–¹æ•°æ®çŸ¥è¯†æœåŠ¡å¹³å°](https://d.wanfangdata.com.cn/thesis/D01697595)

[ä½¿ç”¨GPUè¿è¡ŒTensorFlowæ¨¡å‹çš„æ•™ç¨‹_tensorflow gpu-CSDNåšå®¢](https://blog.csdn.net/m0_71417856/article/details/136298172)

[Build from source on Windows  | TensorFlow](https://tensorflow.google.cn/install/source_windows?hl=en#gpu)

